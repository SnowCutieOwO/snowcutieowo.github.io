# 魔法能力

魔法能力与 mana_abilities.yml 文件的教程。

> 请勿将其与被动[能力](abilities.md)混淆。

**魔法能力（Mana Abilities）** 是一类主动能力，可在激活时消耗魔力。默认情况下，技能升至六级即会解锁魔法能力并每隔六级增强一次。每个技能至多拥有一个魔法能力。魔法能力可以通过修改 `skills.yml` 下的 `mana_ability` 在技能间切换。

## 能力列表

|名称|所属技能|描述|
|---|---|---|
|自动补种（Replenish）|耕作|在生效时间内自动补种作物。手持锄头右键并挖掘作物即可激活。支持收割小麦、胡萝卜、土豆、下界疣及甜菜根。|
|伐树者（Treecapitator）|伐木|在生效时间内连锁砍树。手持斧头右键并挖掘原木方块即可激活。算法并非最终成果且会随版本更新以适配所有树种。|
|超级碎石机（Speed Mine）|挖掘|在生效时间内获得急迫 X。右键镐子右键并挖掘石头类方块即可激活。|
|锋利鱼钩（Sharp Hook）|渔技|左键鱼竿激活。钩中的实体会收到伤害。|
|平整挖掘（Terraform）|采掘|在生效时间内破坏 4 格半径内的相邻方块。右键铲子并挖掘土类方块即可激活。|
|聚能穿射（Charged Shot）|箭术|弹射物会根据距离增加伤害，并在过程中消耗魔力。会扣除与造成额外伤害等值的魔力。左键弓激活。|
|超级吸收（Absorption）|防御|所受伤害会降低双倍魔力值而非生命值。技能生效期间不会自然恢复魔力。左键点击盾牌并受伤即可激活。|
|狂战之刃（Lightning Blade）|战斗|在生效时间内百分比增加攻速。右键剑并攻击实体即可激活。|

## 配置

魔法能力的配置位于 `mana_abilities.yml`。格式与一般的能力配置相似，但有一些不同的选项。

### 通用选项

* `enabled` - 是否启用该魔法能力。禁用魔法能力会导致其失效并从菜单中隐去。等价于将其从 `skills.yml` 下的 `mana_ability` 移除，但 `enabled` 选项更适合临时禁用魔力。
* `base_value` - 魔法能力一级（刚解锁）时的初始值。该值决定了除锋利鱼钩（造成伤害）、聚能穿射（将魔力转化为伤害）与狂战之刃（增加攻速）外的技能持续时间。
* `value_per_level` - 决定每次增强后能力增加的值。有效值的计算公式为 $value = base\_value + (value\_per\_level \times (level - 1))$，`level` 为能力而非技能等级。见下文 `level_up` 了解能力等级的计算公式。
* `base_cooldown` - 魔法能力一级时的初始冷却。单位为秒。技能结束后开始进入冷却时间。
* `cooldown_per_level` - 决定每次增强后冷却改动的值。默认情况下为负值，这样冷却才会随升级越来越短。若你正在增加技能或魔法能力等级上限，请确保这里的设置不会让技能冷却变为负数。
* `base_mana_cost` - 魔法能力一级时的魔力消耗。
* `mana_cost_per_level` - 决定每次增强后魔力消耗改动的值。如果消耗魔力超出玩家上限（受智慧属性影响），那么他们就无法使用该技能。
* `unlock` - 能力解锁的技能等级。它可以为固定整数，也可以是代表 `config.yml` 中 `start_level` 值的内建变量 `{start}` 参与的计算公式。默认配置通过这个方法让首个能力总是先于其他能力解锁。
* `level_up` - 技能升级使得能力增强的时间间隔。玩家的能力等级计算公式为 $level = \frac{skill_level - unlock}{level_up + 1}$，不含由 `max_level` 决定的上限。
* `max_level` - 能力（非技能等级）的最大等级。将值设置为 `1` 表示不限制，使得技能等级的上限可以通过上述公式决定能力的上限。

### 技能特定选项

|选项键名|适用魔法能力|描述|
|---|---|---|
|`require_sneak`|自动补种、伐树者、超级碎石机、平整挖掘、狂战之刃|若为 true，玩家需要蹲下右键才可激活能力。|
|`check_offhand`|自动补种、伐树者、超级碎石机、平整挖掘、狂战之刃|若为 true，副手持有物品并成功交互时不会触主手持有物品对应技能。|
|`sneak_offhand_bypass`|自动补种、伐树者、超级碎石机、平整挖掘、狂战之刃|若为 true，副手持有物品时蹲下右键可触发主手持有物品对应技能。|
|`replant_delay`|自动补种|作物破坏与能力重新种植的间隔。|
|`show_particles`|自动补种|是否在触发能力时显示粒子效果。|
|`prevent_unripe_break`|自动补种|是否防止能力触发时破坏未成熟作物。|
|`max_blocks_multiplier`|伐树者|激活能力时可破坏的最大方块数量。基础数量取决于树种。|
|`give_xp`|伐树者|激活能力时是否获得经验。|
|`haste_level`|超级碎石机|激活能力时给予的急迫等级。需填入不小于 1 的任意等级。|
|`display_damage_with_scaling`|锋利鱼钩|显示在菜单中的伤害是否乘以 stats.yml 中 action_bar_scaling 的值。|
|`enable_sound`|锋利鱼钩、聚能穿射|激活能力时是否播放音效。|
|`disable_health_check`|锋利鱼钩|若为 true，即便伤害为 0，仍然会试图攻击。仅在遇到兼容性问题时建议启用。|
|`always_enabled`|聚能穿射|若为 true，玩家解锁能力后所有的弹射物都会触发聚能穿射。可通过左键点击弓切换。|
|`max_blocks`|平整挖掘|激活能力时可破坏的最大方块数量。|
|`enable_particles`|超级吸收|吸收伤害时是否显示粒子效果。|

## 消息

魔法能力的名称与描述可以在消息文件中的 `mana_abilities` 部分修改。

## 禁用魔法

魔法是魔法能力系统的核心组成，但你也可以通过如下步骤禁用它：

1. 将 `config.yml` 中的 `mana.enabled` 设置为 false。这会移除魔法能力的魔法消耗与菜单中大部分魔力有关的内容。魔法能力仍然会生效而不消耗魔力，除了超级吸收与聚能穿射，它们因完全依赖魔力而会被完全禁用。
2. 在 `messages/global.yml` 文件中，通过移除 `action_bar.idle` 内的 <code v-pre>{{action_bar.mana_display}}</code> 部分与多余空格。因为空闲状态的 AcionBar 只会显示生命值，你也可以将 `config.yml` 下的 `action_bar.idle` 设置为 false 将其禁用。
3. 之后，魔法功能就被禁用了。但是你还需要替换消息文件中的语言文件，将魔力相关的词汇都去除，如“魔法能力”。